import streamlit as st
from docx import Document
from PyPDF2 import PdfReader
import base64
import os
import tempfile

st.set_page_config(page_title="ููุตุฉ ุฅุนุฏุงุฏ ุงูุนุฑูุถ - ูุชูุงุฒู", layout="centered")

st.title("๐ ููุตุฉ ุฅุนุฏุงุฏ ุงูุนุฑูุถ - ูุชูุงุฒู")
st.markdown("ูู ุจุฑูุน ูุฑุงุณุฉ ุงูุดุฑูุท ูุณูุชู ุชูููุฏ ุนุฑุถ ููู ุชููุงุฆููุง ุจููุณ ุชูุณูู ุนุฑูุถ ูุชูุงุฒู")

uploaded_file = st.file_uploader("๐ค ุงุฑูุน ูุฑุงุณุฉ ุงูุดุฑูุท (PDF)", type=["pdf"])
project_name = st.text_input("๐ ุงุณู ุงููุดุฑูุน")
client_name = st.text_input("๐๏ธ ุงุณู ุงูุฌูุฉ")
gov_logo = st.file_uploader("๐๏ธ ุดุนุงุฑ ุงูุฌูุฉ ุงูุญููููุฉ (ุงุฎุชูุงุฑู)", type=["png", "jpg"])

# ูุงูุจ ุซุงุจุช ูุนูุงููู ุงูุนุฑุถ ุงูููู
SECTION_TITLES = [
    "ูู ูุญู",
    "ุฑุคูุชูุง",
    "ุฑุณุงูุชูุง",
    "ุฎุฏูุงุชูุง",
    "ููููุง ูููุดุฑูุน",
    "ุฃูุฏุงู ุงููุดุฑูุน",
    "ูุทุงู ุงูุนูู ูุงููุณุคูููุงุช",
    "ุงููููุฌูุฉ ุงูููุชุฑุญุฉ ูุชูููุฐ ุงููุดุฑูุน",
    "ุงูุฎุทุฉ ุงูุฒูููุฉ ูููุดุฑูุน",
    "ูุฎุฑุฌุงุช ุงููุดุฑูุน ุงููุชููุนุฉ",
    "ุงููุฑูู ุงูููุชุฑุญ",
    "ูููู ุงููุฑูู ูุฎุจุฑุงุชู",
    "ุงูููุญูุงุช ุงููููุฉ"
]

# ูุตูุต ุงูุชุฑุงุถูุฉ ููู ูุณู
DEFAULT_CONTENT = {
    "ูู ูุญู": "ูุญู ูู ูุชูุงุฒู ููููููู ุงููุคุณุณุงุช ูู ุงูุชุญูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู ุจุซูุฉ ุนุจุฑ ุฎุฏูุงุช ุงุณุชุฑุงุชูุฌูุฉ ูุชุทุจูููุฉ...",
    "ุฑุคูุชูุง": "ุฃู ูููู ุงูุดุฑูู ุงูููุซูู ูู ุงูุชุญูู ุงููุคุณุณู ูุญูููุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู.",
    "ุฑุณุงูุชูุง": "ุชูููู ุงูููุธูุงุช ูู ุชูููุฐ ุงุณุชุฑุงุชูุฌูุงุชูุง ุจูุฌุงุญ ูููุงุฏุฉ ุงูุชุญูู ุนุจุฑ ุฃุทุฑ ูุนุงูุฉ.",
    "ุฎุฏูุงุชูุง": "ููุฏู ุฎุฏูุงุช ูู ุงูุญูููุฉุ ุฅุฏุงุฑุฉ ุงููุดุงุฑูุนุ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑุ ุงูุฐูุงุก ุงูุงุตุทูุงุนูุ ูุงูุงูุชุซุงู ูููุนุงููุฑ ุงูุฏูููุฉ...",
    "ููููุง ูููุดุฑูุน": "ุงุณุชูุงุฏูุง ุฅูู ุงููุฑุงุณุฉุ ููุฏุฑู ุฃู ุงูุฌูุฉ ุชุณุนู ุฅูู...",
    "ุฃูุฏุงู ุงููุดุฑูุน": "ููุฏู ุงููุดุฑูุน ุฅูู...",
    "ูุทุงู ุงูุนูู ูุงููุณุคูููุงุช": "ูุชุถูู ูุทุงู ุงูุนูู ุชูููุฑ...",
    "ุงููููุฌูุฉ ุงูููุชุฑุญุฉ ูุชูููุฐ ุงููุดุฑูุน": "ููุชุฑุญ ูููุฌูุฉ ุชุนุชูุฏ ุนูู...",
    "ุงูุฎุทุฉ ุงูุฒูููุฉ ูููุดุฑูุน": "ูู ุงููุชููุน ุชูููุฐ ุงููุดุฑูุน ุฎูุงู...",
    "ูุฎุฑุฌุงุช ุงููุดุฑูุน ุงููุชููุนุฉ": "ุชุดูู ุงููุฎุฑุฌุงุช ูุง ููู...",
    "ุงููุฑูู ุงูููุชุฑุญ": "ูุชููู ุงููุฑูู ูู ูุฎุชุตูู ูู...",
    "ูููู ุงููุฑูู ูุฎุจุฑุงุชู": "ุชู ุชุตููู ูููู ุงููุฑูู ููุดูู...",
    "ุงูููุญูุงุช ุงููููุฉ": "ุณูุชู ุฅุฑูุงู ุฌููุน ุงููุณุชูุฏุงุช ุงูุฏุงุนูุฉ ููุง."
}

# ุงุณุชุฎุฑุงุฌ ุงููุต ูู ุงููุฑุงุณุฉ
@st.cache_data
def extract_text_from_pdf(file):
    reader = PdfReader(file)
    text = ""
    for page in reader.pages:
        text += page.extract_text() + "\n"
    return text

# ุชุญููู ุงููุฑุงุณุฉ ูุชูููุฏ ูุญุชูู ูุฎุตุต (ุจุณูุท ูุจุฏุฆู)
def parse_requirements(text):
    content = DEFAULT_CONTENT.copy()
    if "ุงูุฃูุฏุงู" in text:
        content["ุฃูุฏุงู ุงููุดุฑูุน"] = "ุชู ุชุญุฏูุฏ ุฃูุฏุงู ุงููุดุฑูุน ุจูุงุกู ุนูู ุงููุฑุงุณุฉ ูุชุดูู..."
    if "ูุทุงู ุงูุนูู" in text:
        content["ูุทุงู ุงูุนูู ูุงููุณุคูููุงุช"] = "ููููุง ูููุฑุงุณุฉุ ูุดูู ูุทุงู ุงูุนูู..."
    if "ุงูุฌุฏูู ุงูุฒููู" in text:
        content["ุงูุฎุทุฉ ุงูุฒูููุฉ ูููุดุฑูุน"] = "ุชุดูุฑ ุงููุฑุงุณุฉ ุฅูู ุชูููุฐ ุงููุดุฑูุน ุฎูุงู..."
    return content

if st.button("๐ ุชูููุฏ ุงูุนุฑุถ ุงูููู"):
    if uploaded_file and project_name and client_name:
        raw_text = extract_text_from_pdf(uploaded_file)
        parsed_sections = parse_requirements(raw_text)

        doc = Document()
        doc.add_heading(f"ุงูุนุฑุถ ุงูููู ููุดุฑูุน {project_name}", level=1)
        doc.add_paragraph(f"ุงูุฌูุฉ: {client_name}")

        for title in SECTION_TITLES:
            doc.add_heading(title, level=2)
            doc.add_paragraph(parsed_sections.get(title, ""))

        with tempfile.NamedTemporaryFile(delete=False, suffix=".docx") as tmp:
            doc.save(tmp.name)
            tmp_path = tmp.name

        with open(tmp_path, "rb") as f:
            st.download_button("๐ฅ ุชุญููู ุงูุนุฑุถ ุงูููู (Word)", f, file_name=f"ุนุฑุถ_ููู_{project_name}.docx")

        st.success("โ ุชู ุชูููุฏ ุงูุนุฑุถ ุงูููู ุจูุฌุงุญ!")
    else:
        st.error("ูุฑุฌู ุชุนุจุฆุฉ ุฌููุน ุงูุญููู ุงููุทููุจุฉ.")
